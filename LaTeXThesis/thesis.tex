\documentclass[11pt,a4paper]{report} 

% Für doppelseitigen Ausdruck (nur bei > 60 Seiten sinnvoll)
% \usepackage{ifthen}
% \setboolean{@twoside}{true}
% \setboolean{@openright}{true} 

\include{preamble} % alle Pakete und Einstellungen

% Hier anpassen 
\newcommand{\welchethesis}{Bachelor}
% \newcommand{\welchethesis}{Master}
\newcommand{\thesisofwas}{of Science}
\newcommand{\studiengang}{Technische Informatik}
% \newcommand{\studiengang}{Medizintechnik}
\newcommand{\titel}{Entwicklung eines Frameworks zur Darstellung von 
Smartphone-Sensordaten 
für die didaktische Unterstützung von Programmiervorlesungen}
\newcommand{\kurztitel}{Template Abschlussarbeit}
\newcommand{\autor}{Marius Cerwenetz}
\newcommand{\datum}{XX. Juli 2022} % Abgabedatum
\newcommand{\ort}{Mannheim}
\newcommand{\referent}{Prof.\ Dr.\ Peter Barth}
\newcommand{\korreferent}{Prof.\ Dr.\ Jens-Matthias Bohli}

\begin{document}
\include{vorspann} % Titelseite, Erklärungen, etc.

\begin{abstract}
  Programmierenlernen fällt besonders am Anfang schwer.
  Embeddedprojekte erlauben mit vergleichsweise wenig Aufwand einen gelungen Einstieg mit effektiver Lernerfahrung.
  Solche Projekte benötigen allerdings viel Peripherie und Hardware.
  Diese benötigt wiederrum eine nicht niedrigschwellige Erfahrung zum Beispiel im Umgang mit Microcontrollern.
  Smartphones haben diese Nachteile nicht bieten allerdings trotzdem einen hohen Umfang an Sensoren.
  \\
  In dieser Arbeit wird ein Framework erstellt, dass das Smartphone nutzt um mit dem Microcontroller kleine Softwareprojekte umzusetzen.
  Kleine Aufgabenstellungen mit Musterlösungen werden ausgearbeitet und mitgereicht.
\end{abstract}

\tableofcontents

\chapter{Einführung} \label{chap:intro}
MINT-Berufe leiden hierzulande unter einem akuten Fachkräftemangel.
Das Institut der deutschen Wirtschaft ermittelte für April 2021 ein Unterangebot von 145.100 Personen \cite{mint_jahresreport} in 36 MINT-Berufskategorien. 
Digitalisierungs-Projekte geraten dadurch ins Stocken.
\\
Nicht zuletzt er auch ein Kräftemangel in der Softwareentwicklung.
Es fehlen Programmiererinnen und Programmierer.
Softwareentwicklung ist gerade in der Lernphase nicht trivial und abstrakt.
Unlebendige Übungsaufgaben die beispielsweise Konsolenein- und ausgaben realisieren schrecken zukünftige Programmierinnen und Programmierer eher ab als sie zu ermutigen.
\\
Microcontroller sind bereits eine große Hilfe, da hier spielerisch kleine Projekte realisiert werden können.
So können schon früh in Schulen Kinder an die Programmierung herangerführt werden.
Sie lernen spielerisch kleine Programme zu entwickleln und verstehen die ihnen beigebrachten Abläufe durch schnelle Anwendung.
Microcontroller sind jedoch auch mit Anschaffungskosten verbunden und für kleine Anwendungen, welche Sensoren verwenden, wird viel zusätzliches Material wie zum Beispiel Breadboards, Verbindungskabel und Erweiterungsboards benötigt.
Moderne Smartphones bieten hier Abhilfe da Sie meistens mit verschiedenen Sensoren bespickt sind, wie zum Beispiel: Kompass, GPS, Microphon oder Kamera.
Viele Kinder besitzen bereits mit 10 Jahren \cite{bitkom_smartphones} ein Smartphone. 
\\
Im Rahmen dieser Arbeit soll ein Framework entwickelt werden, dass das Smartphone von Anwendern einbindet um Sie beim Programmierenlernen zu unterstützen.
Dieses orientiert sich ganz an bereits bestehenden System wie Arduino und Microbit.
Kleine Interaktionsmöglichkeiten werden geschaffen.

Benötigt werden dafür eine Library zum Einbinden, eine Python-Anwendung und eine mobile Anwendung für Android Smartphones.

\subsection*{Anwendung}
Die Anwendung besteht aus einem Textfeld, einer Ausgabe-LED, einer Signal LED für Nutzereingaben und zwei Buttons.
Auf dem Textfeld können verschiedene Ausgaben präsentiert werden.
Die Ausgbale LED kann vom Computer aus an und ausgeschaltet werden.
Die Signal-LED dient dazu dem Nutzer zu signalisieren, ob sich das Smartphone gerade in einem Aufnahmeprozess befindet.
Die Buttons werden verwendet um auf dem PC Steuerbefehle auszuführen.
\\
Neben den Ein- und Ausgabemöglichkeiten im UI-Screen kann zur Eingabe auch noch das Microphon und das accelerometer genutzt werden, sofern vorhanden.
Als Ausgabemöglichkeiten kommen der Vibrationsmotor sowie der Lautsprecher des Smartphones zum Einsatz.

\chapter{Experimente/Aufgaben} \label{chap:Experimente}

\section*{Aufgaben}
Dieses Kapitel enthält verschiedene Beispielaufgaben die mit dem Framework gelöst werden sollen.
Die Benutzung der API dazu wird später geschildert.


\textbf{Disco}\\
Die LED muss ganz schnell blinken.
% Ablauf: \verb|led_on, sleep, led_off ...|
\\

\textbf{Diebstahl-Alarm}\\
Wenn nach dem Telefon gegriffen wird soll die LED blinken.
Wenn man sich davon entfernt soll sie wieder aus sein.
\\

\textbf{Würfeln}\\
Das Smartphone wird geschüttelt.
Ein random Zahlenwert wird zurückgegeben.
Je nachdem welches Ergebnis zurückkommt soll ein Wert auf dem Display angezeigt werden.
\\
% Ablauf: \verb|get_random(), displayText|

\textbf{Klatsch-Zähler}\\
Der Anwender möchte wissen wie oft in einem bestimmten Zeitraum geklatscht wurde.
Ein Methodenaufruf startet in der Androidanwendung eine Activity, die innerhalb des im Argument genannten Zeitraums die Anzahl der maximalen Lautstärkeamplituden des Mikrophons misst und die Anzahl zurückgibt.
Diese soll im Textfeld angezeigt werden.
\begin{figure}[htbp]
  \centering
  \includegraphics[width=.9\textwidth]{images/count_claps.png}
  \caption{Klatsch-Zähler}
  \label{fig:clap_count}
\end{figure}
% Vorgehen: \verb|num_of_spikes|
\\

\textbf{Dreh-Zähler}\\
Ein Nutzer möchte in einem bestimmten Zeitraum zählen wie oft das Smartphone gedreht wurde.





\section*{API}\label{sec:API}
Gelöst werden sollen die Aufgaben durch das Aufrufen der API.
Diese bietet die benötigten Funktionen an.
Die Aufrufe sind frei miteinander kombinierbar, so dass Aufgaben erweitert werden können.

\subsection*{Eingaben}

\textbf{Auslesen der accelerometer-Daten}\\
Ein User will den Wert der X, Y und Z Koordinaten des Smartphones wissen.
So kann er bspw. feststellen, ob das Smartphone gerade nach unten, oben oder horizontal bewegt wurde.
Kippbewegungen werden nicht detektiert.
\lstinputlisting[]{listings/api/acc.c}

\textbf{Lautstärkepegelmessung}\\
Ein User möchte den aktuellen Lautstärkepegel messen.
\lstinputlisting{listings/api/vol.c}

\textbf{Annäherungssensor-Messung}\\
Ein User möchte wissen, ob ein Objekt unmittelbar vor den Annäherungssensor steht.
Der Aufruf erfolgt folgendermaßen.
\lstinputlisting{listings/api/proxy.c}

\textbf{Amplituden-Spike-Messung mit Zeitraum}\\
Ein User möchte wissen, wie oft die Lautstärke innerhalb eines angegebenen Zeitraums t ein gewisses Limit überstiegen hat.
Der Aufruf könnte dabei folgendermaßen laufen.
\lstinputlisting{listings/api/numofspikes.c}


\textbf{Umdrehungsmessung mit Zeitraum}\\
Ein User möchte wissen, wie oft das Smartphone innerhalb eines angegebenen Zeitraums t gedreht wurde.
Der Aufruf sieht folgendermaßen aus.
\lstinputlisting{listings/api/numofspikes.c}


\subsection*{Ausgaben}\label{subsec:Ausgaben}

\textbf{Display-Ausgabe}\\
Um auf dem Smartphone einen beliebigen Text anzuzeigen.
Dies kann er zum Beispiel wie im folgenden Beispielcode machen.
\lstinputlisting[]{listings/api/display.c}

\textbf{LED leuchten lassen}\\
Ein User möchte eine "LED" auf dem Display ansteuern.
Dies kann er so machen.
\lstinputlisting[]{listings/api/led.c}

\textbf{LEDt toggeln}\\
Ein User möchte den Zustand einer LED auf dem Display auf "aus" stellen wenn Sie an war und auf "an" wenn Sie aus war.
Dies kann er so machen.
\lstinputlisting[]{listings/api/led.c

\textbf{Vibrationsauslöser}\\
Ein Nutzer möchte das Smartphone auf Anfrage virbrieren lassen.
Der Aufruf einer Methode lässt das Smartphone einmal vibrieren.
\lstinputlisting[]{listings/api/vib.c}

\textbf{Audio-Ausgabe}\\
Ein Nutzer möchte den Pfad zu einer Audio-Datei angeben und
\lstinputlisting[]{listings/api/vib.c}

\section*{Android-Anwendung}
Für Ausgaben existent eine Android Anwendung die verschiedene Interaktionsmöglichkeiten bereitstellt.
Das Userinterface wird in Grafik \ref{fig:android_ui} gezeigt.
Bereit stehen eine LED bzw. ein Button, eine Textausgabezeile und eine Checkbox.
Der Button ist nicht drückbar.
Eine eingabe ist nicht vorgesehen.
Er fungiert als Signal-LED die getoggelt werden kann.
\begin{figure}[htbp] 
  \centering
  \includegraphics[width=.9\textwidth]{images/android_ui.png}
  \caption{Android App UI}
  \label{fig:android_ui}
\end{figure}



\chapter{Architektur} \label{chap:architektur}
Der Aufbau des Frameworks besteht aus einer mobilen Anwendung für Android-Smartphones, Bibliothek in der Programmiersprache C und einer Middleware die den Austausch Koordiniert.
\\
Clientseitig erfolgen sämtliche Aufrufe die Sensordaten abgreifen oder Steueranfragen senden immer erst per UDP über die Middleware.
\\
Die Middleware sammelt, sobald sich eine Android-Anwendung bei ihr anmeldet, gewisse Sensordaten und speichert Sie intern zwischen, damit Sie schnell vorrätig vorliegen.
Die Speicherung erfolgt in einem seperaten Thread, der die letzten Zustände der Sensordaten hält.
Werden Sensordaten abgerufen werden Sie aus der Liste entfernt.
Sollten mehr als 5 Sensorwerte vorliegen werden die ältesten entfernt um die Ergebnisse aktuell zu halten.
Sind noch keine Daten vorhanden, oder wird ein Sensor angefragt der im Smartphone nicht existent ist, wird ein Fehlercode zwischengespeichert.
Die Verfügbarkeit der jeweiligen Sensoren wird beim Start der Anwendung ermittelt.
\\
Steueraufrufe werden beim Aufruf über ein seperates Topic versandt.
Der Austausch erfolgt auf mehreren Topics, da manche Nachrichten, wie Steuerbefehle wie in \ref{subsec:Ausgaben} erwähnt, mit einem höheren QOS-Level versendet werden müssen als im Moment existente Sensordaten die nur eine kurzzeitige Relevanz besitzen und deren Zustellung nicht obligatorisch ist.
Auf diesem Topic werden Nachrichten mit der QOS von 2 versandt auf dem für reguläre Sensordaten mit einer QOS von 0.
% Todo: admin channel? Erster Aufbau auf admin channel mit anschließender negotiation auf welchen channeln gesendet werden soll. Wie hart aufziehen?
\begin{figure}[htbp]
  \centering
  \includegraphics[width=.9\textwidth]{images/design.png}
  \caption{System-Aufbau}
  \label{fig:design}
\end{figure}


\section*{Android Anwendung}
Die Android-Anwendung läuft auf dem Smartphone des Anwenders.
Sie besteht aus einer Haupt-Activity deren außerlicher Aufbau in \ref{chap:intro} beschrieben ist. 
\\
In der Haupt-Activity wird ein Service gestartet und gebunden.
Der Service baut eine Verbindung zu einem MQTT Server auf.
Dort verbindet er sich den beiden Topics. 
Die Activity bindet beim Start den MQTT-Service ein.
Stellt ein Client über die Bibliothek auf einem Computer eine Anfrage wird dieser Aufruf, wie z.B. eine Ausgabe auf einem Textfeld an das Smartphones,  zuerst zur Middleware geleitet.
Diese leitet die Anfrage weiter an das Smartphone, dass dann den jeweiligen Befehl ausführt.
Dies beeinhaltet vor allem Ausgaben, sowie Eingaben die eine Nutzerinteraktion mit reduziertem Ergebnis.
Zum Beispiel alle Eingaben die etwas in einem angegebenen Zeitraum messen.
Falls ein Sensor angefragt wird der auf dem Smartphone nicht existiert wird eine Nachricht mit einer Fehlermeldung zurückgegeben.
\begin{figure}[htbp]
  \centering
  \includegraphics[width=.9\textwidth]{images/android_app.png}
  \caption{Android-App-Aufbau}
  \label{fig:android_app}
\end{figure}


\section*{Nachrichtenformate}
Die Nachrichten werden im JSON-Format übertragen.
Nachfolgendes Listing zeigt beispielsweise den Aufruf die LED einzusschalten.
\lstinputlisting[]{listings/messages/led.json}
Folgende Nachricht beschreibt beispielsweise den übermittelten Sensorwert des accelerometers.
\lstinputlisting{listings/messages/accell.json}

% Listen wenn überhaupt ans Ende und nicht an den Anfang.
% Meist ist das aber unnötig.
% \listoffigures % Liste der Abbildungen 
% \listoftables % Liste der Tabellen
% \newpage

\bibliographystyle{plain} % Literaturverzeichnis
\begin{btSect}{thesis} % mit bibtopic Quellen trennen
\addcontentsline{toc}{chapter}{Literaturverzeichnis und Online-Quellen}
\section*{Literaturverzeichnis}
\btPrintCited
\end{btSect}
\begin{btSect}{online}
\section*{Online-Quellen}
\btPrintCited
\end{btSect}
% dann mit "bibtex thesis1" und "bibtex thesis2" arbeiten

\end{document}
;;; Local Variables:
;;; ispell-local-dictionary: "de_DE-neu"
;;; End:
